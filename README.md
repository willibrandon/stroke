# Stroke

A .NET 10 port of [Python Prompt Toolkit](https://github.com/prompt-toolkit/python-prompt-toolkit).

## Status

**In Development** — Core foundation complete.

### Completed

- **Project Setup** — Solution structure, .NET 10 configuration, CI/CD pipeline
- **Core Primitives** — `Point`, `Size`, `WritePosition` value types
- **Selection System** — `SelectionState`, `SelectionType`, `PasteMode` for tracking text selections
- **Document Class** — Immutable text buffer with cursor position and selection state
  - Text access (before/after cursor, current line, lines collection)
  - Line/column navigation with row/col translation
  - Word and WORD navigation (Vi-style w/W/b/B/e/E motions)
  - Character search (Vi f/F/t/T motions)
  - Selection handling (Characters, Lines, Block modes)
  - Clipboard paste operations (Emacs, ViBefore, ViAfter)
  - Paragraph navigation
  - Bracket matching
  - Flyweight caching for memory efficiency
- **Clipboard System** — Text storage with Emacs-style kill ring and OS clipboard integration
  - `IClipboard` interface with SetData, GetData, SetText, Rotate
  - `InMemoryClipboard` with configurable kill ring size (default 60)
  - `SystemClipboard` for OS clipboard synchronization via platform-specific providers
    - macOS: `pbcopy`/`pbpaste`
    - Windows: Win32 `OpenClipboard`/`SetClipboardData` P/Invoke
    - Linux X11: `xclip` or `xsel`
    - Linux Wayland: `wl-copy`/`wl-paste`
    - WSL: `clip.exe`/`powershell.exe Get-Clipboard`
  - `ClipboardProviderDetector` auto-detects platform and available tools
  - `DynamicClipboard` for runtime clipboard switching
  - `DummyClipboard` for disabled clipboard scenarios
  - Selection type preservation (Characters, Lines, Block) across clipboard round-trips
  - Best-effort error handling (write failures silently swallowed, read failures return empty)
  - Thread-safe operations
- **Auto Suggest System** — History-based input suggestions
  - `ISuggestion` interface for suggestion providers
  - `AutoSuggest` with configurable suggestion sources
- **Cache Utilities** — Performance caching for terminal rendering
  - `SimpleCache<TKey, TValue>` with FIFO eviction (default size: 8)
  - `FastDictCache<TKey, TValue>` with auto-population on miss (default size: 1M)
  - `Memoization` for function result caching (1/2/3-arg overloads)
  - Thread-safe operations
- **Buffer Class** — Mutable wrapper with undo/redo stack
  - Text editing (insert, delete, newline, join lines, swap characters)
  - Undo/redo operations with state restoration
  - Cursor navigation (left, right, up, down, bracket matching)
  - History navigation with optional prefix-based filtering
  - Selection operations (character, line, block selection types)
  - Clipboard integration (Emacs, Vi-before, Vi-after paste modes)
  - Completion state management for autocompletion
  - Text transformation (lines, regions, current line)
  - Read-only mode with bypass option
  - Validation support (sync and async)
  - Auto-suggest integration
  - External editor support
  - Thread-safe operations (87% test coverage)
- **History System** — Command history storage with multiple backends
  - `IHistory` interface with load/store/append operations
  - `InMemoryHistory` for session-only storage
  - `FileHistory` for persistent file-backed storage (Python PTK format)
  - `ThreadedHistory` wrapper for background loading
  - `DummyHistory` for privacy/disabled scenarios
  - Thread-safe operations (>90% test coverage)
- **Validation System** — Input validation with error positioning
  - `IValidator` interface with sync and async validation
  - `ValidatorBase` abstract class with `FromCallable` factory
  - `DummyValidator` null-object pattern for disabled validation
  - `ConditionalValidator` for filter-based conditional validation
  - `DynamicValidator` for runtime validator switching
  - `ThreadedValidator` for background thread validation
  - Thread-safe operations (100% test coverage)
- **Search System** — Text search state and operations
  - `SearchDirection` enum (Forward, Backward)
  - `SearchState` mutable query object with thread-safe properties
  - `Invert()` method and `~` operator for direction reversal (returns new instance)
  - `IgnoreCaseFilter` delegate for runtime case sensitivity
  - `SearchOperations` static class with `StartSearch`, `StopSearch`, `DoIncrementalSearch`, `AcceptSearch` lifecycle methods
  - `SearchFilters.SearchBufferIsEmpty` filter for empty search buffer detection
  - Thread-safe operations (100% SearchState coverage)
- **Keys Enum** — Input key definitions
  - `Keys` enum with 151 key values matching Python Prompt Toolkit
  - Control keys, function keys, navigation keys, special keys
- **Completion System** — Autocompletion with 12 completers
  - `ICompleter` interface with sync and async completion
  - `CompleterBase` abstract class with default implementations
  - `Completion` record with text, display, meta, and start position
  - `CompleteEvent` record for completion trigger context
  - `WordCompleter` for word list completion with prefix/middle matching
  - `PathCompleter` for filesystem path completion
  - `FuzzyCompleter` for fuzzy character-in-order matching
  - `FuzzyWordCompleter` convenience wrapper
  - `DeduplicateCompleter` for removing duplicate completions
  - `MergeCompleter` for combining multiple completers
  - `ThreadedCompleter` for background thread completion
  - `DummyCompleter` null-object pattern for disabled completion
  - `NestedCompleter` for context-sensitive hierarchical completion
  - `ExecutableCompleter` for system executable completion
  - `SystemCompleter` for shell command completion (executables + file paths with quoting)
  - `ConditionalCompleter` for filter-based conditional completion
  - `DynamicCompleter` for runtime completer switching
  - Thread-safe operations (>80% test coverage)
- **Mouse Events** — Mouse input handling for terminal UI
  - `MouseEventType` enum (MouseUp, MouseDown, ScrollUp, ScrollDown, MouseMove)
  - `MouseButton` enum (Left, Middle, Right, None, Unknown)
  - `MouseModifiers` [Flags] enum (Shift, Alt, Control)
  - `MouseEvent` immutable record struct with position, type, button, modifiers
  - `MouseHandlers` 2D handler grid with O(1) lookup (sparse dictionary storage)
  - `NotImplementedOrNone` for event bubbling pattern
  - Thread-safe operations (100% test coverage)
- **Input System** — Cross-platform terminal input abstraction
  - `IInput` interface for terminal input sources
  - `Vt100Parser` for VT100/ANSI escape sequence parsing
  - `KeyPress` record struct with key identity and raw data
  - `AnsiSequences` dictionary mapping escape sequences to keys
  - Platform implementations: `Win32Input` (Windows), `Vt100Input` (POSIX)
  - Pipe input for testing: `IPipeInput`, `PosixPipeInput`, `Win32PipeInput`
  - `InputFactory` for platform-appropriate input creation
  - Raw/cooked terminal mode support
  - Mouse protocol support (X10, SGR, urxvt)
  - Thread-safe operations (>80% test coverage)
- **Formatted Text System** — Styled text parsing and rendering
  - `Html` class for HTML-like markup parsing (`<b>`, `<i>`, `<u>`, `<s>`, custom elements)
  - Color attributes (`fg`, `bg`, `color`) with ANSI, hex, and named color support
  - `%` operator for Python-style string interpolation with automatic HTML escaping
  - `Ansi` class for ANSI escape sequence parsing (SGR codes, 256-color, true color)
  - `%` operator for Python-style string interpolation with automatic ANSI escape neutralization
  - `Template` class for placeholder interpolation with lazy evaluation
  - `PygmentsTokens` for Pygments-style token conversion
  - `FormattedTextUtils` utilities (ZeroWidthEscape, FragmentListWidth, SplitLines, Merge)
  - `AnyFormattedText` union type with implicit conversions
  - Thread-safe operations (>90% test coverage)
- **Layout Dimensions** — Sizing constraints for terminal UI layout
  - `Dimension` immutable class with min/max/preferred/weight properties
  - `Dimension.Exact(amount)` and `Dimension.Zero()` factory methods
  - `DimensionUtils.SumLayoutDimensions` for sequential layout aggregation
  - `DimensionUtils.MaxLayoutDimensions` for parallel layout aggregation
  - `ToDimension` type conversion with callable support
  - `D` static alias class for shorter syntax
  - Thread-safe (immutable, >80% test coverage)
- **Filter System** — Composable boolean conditions for feature activation
  - `IFilter` interface with `Invoke()`, `And()`, `Or()`, `Invert()`
  - `Filter` abstract base with operators (`&`, `|`, `~`) and per-instance caching
  - `Always` and `Never` singletons for constant filters
  - `Condition` wrapper for `Func<bool>` dynamic evaluation
  - `FilterOrBool` union type for API ergonomics
  - `FilterUtils` static utilities (`ToFilter()`, `IsTrue()`)
  - Boolean algebra: identity, annihilation, short-circuit, double negation
  - Thread-safe operations (100% test coverage)
- **Styles System** — Visual styling for terminal UI components
  - `Style` class with rule-based styling, class lookup, and style inheritance
  - `Attrs` record struct for color/formatting attributes (color, bgcolor, bold, italic, etc.)
  - `BaseStyle` abstract class for custom style implementations
  - `NamedColors` with 148 CSS colors (from Python Prompt Toolkit)
  - `AnsiColors` with 16 standard + 256 indexed palette colors
  - Color utilities: `ParseColor`, `AnsiColorToRgb`, hex/ANSI conversion
  - Style transformations: `SwapLightAndDarkStyleTransformation`, `ReverseStyleTransformation`, `AdjustBrightnessStyleTransformation`, `ConditionalStyleTransformation`
  - `DynamicStyle` and `ConditionalStyle` for runtime styling
  - `MergeStyles` for combining multiple style sources
  - Default styles: `PromptToolkitStyle`, `ColorsStyle`, `WidgetsStyle`, `PygmentsDefaultStyle`
  - `PygmentsStyleUtils` for syntax highlighting integration
  - Thread-safe operations (>80% test coverage)
- **Output System** — Terminal output abstraction with VT100/ANSI support
  - `IOutput` interface with 30+ terminal control methods
  - `Vt100Output` VT100/ANSI escape sequence implementation
  - `PlainTextOutput` for redirected streams (files, pipes)
  - `DummyOutput` no-op implementation for testing
  - `ColorDepth` enum (1-bit, 4-bit, 8-bit, 24-bit) with environment detection
  - `NO_COLOR`, `STROKE_COLOR_DEPTH`, `COLORTERM`, `TERM` environment variable support
  - Thread-safe color caches for 16-color and 256-color palette mapping
  - `CursorShape` enum with block, underline, beam shapes and blinking variants
  - `ICursorShapeConfig` with modal Vi/Emacs cursor shape support
  - `OutputFactory` for platform detection (TTY vs redirected)
  - `FlushStdout` helper for immediate write-and-flush operations
  - Synchronized output (DEC Mode 2026) for atomic frame commits — terminals buffer all output between begin/end markers and paint as a single frame; unsupported terminals silently ignore the sequences *(documented deviation: not present in Python Prompt Toolkit)*
  - Thread-safe operations (85.7% test coverage)
- **Key Bindings System** — Extensible key binding infrastructure for terminal input handling
  - `IKeyBindings` interface with binding lookup and prefix matching
  - `KeyBindings` class with FIFO-based caching (`SimpleCache`)
  - `Binding` class with filter, eager, isGlobal, recordInMacro, saveBefore support
  - `KeyBindingDecorator` for fluent binding creation with optional parameters
  - `KeyOrChar` union type for key enum or character literal bindings
  - Proxy implementations: `MergedKeyBindings`, `ConditionalKeyBindings`, `GlobalOnlyKeyBindings`, `DynamicKeyBindings`
  - `KeyPress` record struct matching Python Prompt Toolkit's key_binding.key_processor
  - `FilterOrBool` with `HasValue` for distinguishing explicit false from struct default
  - Thread-safe operations (365 tests, >80% coverage)
- **Editing Modes and State** — Vi and Emacs editing mode state management
  - `EditingMode` enum (Vi, Emacs) for key binding set selection
  - `InputMode` enum (Insert, InsertMultiple, Navigation, Replace, ReplaceSingle) for Vi modes
  - `BufferNames` static class with SearchBuffer, DefaultBuffer, SystemBuffer constants
  - `CharacterFind` sealed record for Vi f/F/t/T command targets
  - `ViState` class with InputMode, OperatorFunc, named registers, digraph state, macro recording
  - `EmacsState` class with macro recording (StartMacro, EndMacro, AppendToRecording)
  - `OperatorFuncDelegate` for Vi operator function callbacks
  - InputMode setter side effects (clears operator state when entering Navigation mode)
  - Thread-safe operations with `System.Threading.Lock` (116 tests, 100% coverage)
- **Utilities** — Common utility classes ported from Python Prompt Toolkit
  - `Event<TSender>` pub/sub with `+=` and `-=` operators for handler management
  - `UnicodeWidth` character/string width calculation with thread-safe LRU caching
  - `PlatformUtils` OS detection (Windows/macOS/Linux) and environment variable checks
  - `CollectionUtils.TakeUsingWeights` for proportional item distribution
  - `ConversionUtils` with `ToStr`, `ToInt`, `ToFloat` lazy value conversion
  - `AnyFloat` union type for double values or callables returning double
  - `DummyContext` no-op IDisposable singleton
  - Thread-safe operations (146 tests, >80% coverage)
- **Lexer System** — Syntax highlighting infrastructure for terminal editors
  - `ILexer` interface with `LexDocument(Document)` returning line accessor function
  - `SimpleLexer` single-style lexer for plain text (immutable, thread-safe)
  - `DynamicLexer` for runtime lexer switching via callback
  - `PygmentsLexer` adapter with line caching and generator reuse
  - `IPygmentsLexer` interface for external Pygments-compatible lexers
  - `ISyntaxSync` interface for syntax synchronization strategies
  - `SyncFromStart` singleton (always sync from line 0)
  - `RegexSync` pattern-based sync position finder (MaxBackwards=500)
  - Token conversion: `["Name", "Function"]` → `"class:pygments.name.function"`
  - Generator reuse within 100 lines, MinLinesBackwards=50 for scrolling
  - O(1) cached line retrieval (4ns cache hit vs 14ms cache miss)
  - Thread-safe operations (163 tests, >80% coverage)
- **Vi Digraphs** — RFC1345 digraph mappings for special character insertion
  - `Digraphs` static class with 1,356 mappings from Python Prompt Toolkit
  - `Lookup(char, char)` returns Unicode code point as `int?`
  - `GetString(char, char)` returns character string using `char.ConvertFromUtf32()`
  - `Map` property for full dictionary enumeration
  - `FrozenDictionary` storage for O(1) lookup performance
  - Covers Greek, Cyrillic, Hebrew, Arabic, CJK, box drawing, math symbols, and more
  - Thread-safe via immutability (36 tests, 100% coverage)
- **Regular Languages** — Grammar-based input handling for CLI applications
  - `Grammar.Compile()` compiles regex patterns with Python `(?P<name>...)` named group syntax
  - `CompiledGrammar` with `Match()` and `MatchPrefix()` for full and partial matching
  - `Match` class with `Variables`, `EndNodes`, `TrailingInput` extraction
  - `GrammarCompleter` (ICompleter) delegates to per-variable completers
  - `GrammarLexer` (ILexer) applies per-variable lexers for syntax highlighting
  - `GrammarValidator` (IValidator) validates input against grammar rules
  - Node classes: `AnyNode`, `NodeSequence`, `RegexNode`, `Lookahead`, `Variable`, `Repeat`
  - Thread-safe via immutability (162 tests, >80% coverage)
- **Screen and Character Model** — 2D terminal buffer for rendering
  - `Screen` sparse 2D character buffer with `Dictionary<int, Dictionary<int, Char>>` storage
  - `Char` immutable styled character cell with `FastDictCache` interning (1M entries)
  - `CharacterDisplayMappings` 66 control character display mappings (C0→caret, DEL→^?, C1→hex, NBSP→space)
  - `WritePosition` readonly record struct for rectangular regions
  - `IWindow` marker interface for per-window cursor/menu position tracking
  - Zero-width escape sequence storage for hyperlinks and terminal extensions
  - Z-index deferred drawing via `DrawWithZIndex`/`DrawAllFloats`
  - Region fill with `FillArea` and `AppendStyleToContent`
  - Thread-safe via `System.Threading.Lock` (369 tests, >80% coverage)

- **Layout Containers, Controls, and Window** — Core layout system for terminal UI
  - Containers: `HSplit` (vertical stacking), `VSplit` (horizontal arrangement), `FloatContainer` (overlay positioning)
  - `ConditionalContainer` (filter-based show/hide), `DynamicContainer` (runtime content switching)
  - `AnyContainer` wrapper struct, `IContainer`/`IMagicContainer` interfaces, `ContainerUtils` utilities
  - `Window` container wrapping `IUIControl` with scrolling, margins, cursor highlighting, style inheritance
  - Controls: `BufferControl` (editable text with lexer/search), `FormattedTextControl` (static styled text with mouse handlers)
  - `SearchBufferControl`, `DummyControl`, `UIContent` line-based content model, `IUIControl` interface
  - Margins: `IMargin`, `NumberedMargin`, `ScrollbarMargin`, `PromptMargin`, `ConditionalMargin`
  - Window support: `ScrollOffsets`, `WindowRenderInfo`, `ColorColumn`, `GetLinePrefixCallable`
  - Alignment enums: `HorizontalAlign`, `VerticalAlign`, `WindowAlign`
  - Weighted dimension allocation in HSplit/VSplit with min/max/preferred constraints
  - Thread-safe via `System.Threading.Lock` (>80% coverage)

- **Application System** — Central orchestration layer tying together input, rendering, layout, and key binding
  - `Application<TResult>` with `RunAsync`/`Run` lifecycle and generic result type
  - Channel-based event loop for thread-safe redraws (bounded channel with coalescing)
  - Action channel for marshaling flush timeout and SIGINT callbacks to the event loop
  - `Renderer` with differential screen updates (compares previous/current screen, emits only changes) and synchronized output wrapping (all render/erase/clear wrapped in DEC Mode 2026 for flicker-free display)
  - Flicker-free terminal resize via `ResetForResize()` — defers screen clear to next render cycle instead of immediate erase, eliminating visible blank frames during resize *(documented deviation: not present in Python Prompt Toolkit)*
  - `KeyProcessor` state machine for key binding dispatch with Vi repeat, operator-pending, prefix matching
  - `Layout` class with focus management, walk/find utilities, window tracking
  - `RunInTerminal` for suspending UI to run external commands
  - `AppContext`/`AppSession` with `AsyncLocal` storage and proper nested session stack
  - Background task tracking with automatic cancellation on exit
  - Invalidation coalescing, configurable refresh intervals, min redraw throttling
  - Unix signal handling: SIGWINCH (resize), SIGTSTP (suspend, platform-correct: 18 on macOS, 20 on Linux)
  - `CombinedRegistry` for merged key bindings across system defaults, editing mode, and user bindings
  - `ScrollablePane` visibility toggling
  - Thread-safe operations (6,469 tests, >80% coverage)

- **Input Processors** — Fragment transformation pipeline for per-line text processing before rendering
  - `IProcessor` interface with `TransformationInput`/`Transformation` records
  - `ExplodedList` for single-character fragment manipulation
  - 26 processor implementations: search/selection highlighting, bracket matching, password masking, tab expansion, whitespace visualization, auto-suggestion display, before/after input decorators, conditional/dynamic wrapping
  - `MergedProcessor` with composable position mapping (source↔display)
  - `BufferControl` integration with `InputProcessors` and `DefaultInputProcessors`
  - Thread-safe via immutable records and sealed classes (6,618 tests, >80% coverage)

- **Application Filters** — Domain-specific `IFilter` queries for application state
  - 4 static filter classes: `AppFilters`, `ViFilters`, `EmacsFilters`, `SearchFilters`
  - `AppFilters`: selection, suggestion, completions, read-only, validation, arg, done, multiline, paste mode, editing mode (memoized), focus
  - `ViFilters`: navigation/insert/replace/selection/digraph/text-object-wait mode filters
  - `EmacsFilters`: emacs mode, insert, selection, search filters
  - `SearchFilters`: searching state, searchable control, shift-selection mode
  - `DummyApplication` graceful false for all filters when no app is running
  - Filter composition via `And`/`Or`/`Invert` methods
  - Thread-safe via stateless lambdas and `Condition` caching (6,708 tests, >80% coverage)

- **Completion Menus** — Single-column and multi-column completion menu rendering
  - `MenuUtils` static helpers for styled fragment generation and width-constrained text trimming with ellipsis
  - `CompletionsMenuControl` single-column rendering with optional meta column and mouse handler
  - `CompletionsMenu` container wrapping control in a `Window` with scrollbar margin, conditional visibility, and z-index overlay
  - `MultiColumnCompletionMenuControl` multi-column grid with scroll arrows, column width caching, keyboard (Left/Right) navigation
  - `MultiColumnCompletionsMenu` container with `HSplit` layout combining multi-column grid and meta row
  - `SelectedCompletionMetaControl` for displaying selected completion's meta information
  - Filter-based visibility: `extraFilter & HasCompletions & ~IsDone`
  - Mouse support: click to select, scroll to navigate, arrow clicks for column scrolling
  - Thread-safe via `System.Threading.Lock` on mutable render state (6,805 tests, >80% coverage)

- **Named Commands** — 49 Readline-compatible named commands with static registry
  - `NamedCommands` static registry with `GetByName`/`Register` API backed by `ConcurrentDictionary`
  - Movement commands (10): `beginning-of-buffer`, `end-of-buffer`, `beginning-of-line`, `end-of-line`, `forward-char`, `backward-char`, `forward-word`, `backward-word`, `clear-screen`, `redraw-current-line`
  - Text editing commands (9): `end-of-file`, `delete-char`, `backward-delete-char`, `self-insert`, `transpose-chars`, `uppercase-word`, `downcase-word`, `capitalize-word`, `quoted-insert`
  - Kill/yank commands (10): `kill-line`, `kill-word`, `unix-word-rubout`, `backward-kill-word`, `delete-horizontal-space`, `unix-line-discard`, `yank`, `yank-nth-arg`, `yank-last-arg`, `yank-pop`
  - History commands (6): `accept-line`, `previous-history`, `next-history`, `beginning-of-history`, `end-of-history`, `reverse-search-history`
  - Completion commands (3): `complete`, `menu-complete`, `menu-complete-backward`
  - Macro commands (4): `start-kbd-macro`, `end-kbd-macro`, `call-last-kbd-macro`, `print-last-kbd-macro`
  - Miscellaneous commands (7): `undo`, `insert-comment`, `vi-editing-mode`, `emacs-editing-mode`, `prefix-meta`, `operate-and-get-next`, `edit-and-execute-command`
  - `CompletionBindings` with Readline-style column display and `--MORE--` pagination
  - Custom command registration with `recordInMacro` control
  - Consecutive kill concatenation (forward appends, backward prepends)
  - Thread-safe operations (122 tests, >80% coverage)

- **Scroll Bindings** — Viewport scrolling and page navigation key bindings
  - `ScrollBindings` static class with 8 scroll functions ported from `scroll.py`
  - `ScrollForward`/`ScrollBackward` — full window height with line-height accumulation
  - `ScrollHalfPageDown`/`ScrollHalfPageUp` — half window height (integer division)
  - `ScrollOneLineDown`/`ScrollOneLineUp` — viewport ±1 with conditional cursor adjustment
  - `ScrollPageDown`/`ScrollPageUp` — viewport jump with cursor reposition to first non-whitespace
  - `PageNavigationBindings` static class with 3 binding loaders ported from `page_navigation.py`
  - Emacs bindings: Ctrl-V, Escape+V, PageDown, PageUp (filtered by EmacsMode)
  - Vi bindings: Ctrl-F/B/D/U/E/Y, PageDown, PageUp (filtered by ViMode)
  - Combined loader with `BufferHasFocus` guard via `MergedKeyBindings`
  - Stateless, thread-safe (56 tests, 100% coverage)

- **Mouse Bindings** — Mouse event parsing and dispatch for VT100 and Windows protocols
  - `MouseBindings` static class with `LoadMouseBindings()` returning 4 key bindings
  - XTerm SGR protocol: 96-entry `FrozenDictionary` lookup table with button, event type, and modifier decoding
  - Typical (X10) protocol: 10-entry lookup table with surrogate escape handling
  - URXVT protocol: 4-entry lookup table with unknown-code fallback
  - Scroll-without-position fallback converting ScrollUp/ScrollDown to arrow key presses
  - Windows mouse event handler with platform guard and Win32 coordinate adjustment (ready for Win32Output)
  - Coordinate transforms: 1-based → 0-based, surrogate escape subtraction, rows-above-layout adjustment
  - 8 modifier combinations (Shift, Alt, Control) via bit-field decoding in XTerm SGR
  - Renderer `CursorPos` internal property for Windows coordinate adjustment
  - Stateless, thread-safe via immutable `FrozenDictionary` tables (47 tests, >80% coverage)

- **Basic Key Bindings** — 118 default key bindings for Emacs and Vi insert modes
  - `BasicBindings` static class with `LoadBasicBindings()` returning all default bindings
  - 90 ignored key bindings (control, function, navigation, shift-arrow, delete, insert, tab, SIGINT) with shared no-op handler
  - 16 named command bindings: movement (Home, End, Left, Right), editing (Ctrl+K/U/T/W, Backspace, Delete), tab completion, history navigation, self-insert, Ctrl+D
  - 12 inline handler bindings: Enter multiline, Ctrl+J re-dispatch, Up/Down auto-navigation, bracketed paste with line ending normalization, Ctrl+Z literal insert, quoted insert, delete selection with clipboard
  - Filter composition: `InsertMode` (Vi insert | Emacs insert), `HasTextBeforeCursor`, `InQuotedInsert`, `~HasSelection`
  - Registration order per spec: ignored → readline → self-insert → tab → history → Ctrl+D → Enter → Ctrl+J → auto up/down → delete selection → Ctrl+Z → paste → quoted insert
  - Stateless, thread-safe (178 tests, >80% coverage)

- **Search Bindings** — Incremental search key binding handlers and loaders for Emacs and Vi modes
  - `SearchBindings` static class with 9 handler functions and 2 binding loaders
  - Handlers: `AbortSearch`, `AcceptSearch`, `StartReverseIncrementalSearch`, `StartForwardIncrementalSearch`, `ReverseIncrementalSearch`, `ForwardIncrementalSearch`, `AcceptSearchAndAcceptInput`, `JumpToNextMatch`, `JumpToPreviousMatch`
  - `PreviousBufferIsReturnable` filter for combined search-accept-input binding
  - `LoadEmacsSearchBindings()` — 18 bindings (Ctrl+R/S, Ctrl+C/G, Up/Down, Enter, eager Escape, read-only /, ?, n, N) wrapped in `ConditionalKeyBindings(EmacsMode)`
  - `LoadViSearchBindings()` — 13 bindings (/, ? with navigation/selection direction filters, Ctrl+S/R, Enter, Ctrl+C/G, Backspace-when-empty, Escape) wrapped in `ConditionalKeyBindings(ViMode)`
  - Filter composition: `ControlIsSearchable`, `IsSearching`, `IsReadOnly`, `ViSearchDirectionReversed`, `ViNavigationMode | ViSelectionMode`
  - Stateless, thread-safe (41 tests, >80% coverage)

- **Auto Suggest Bindings** — Fish-style auto suggestion acceptance key bindings
  - `AutoSuggestBindings` static class with `LoadAutoSuggestBindings()` returning 4 key bindings
  - Full suggestion acceptance: Ctrl-F, Ctrl-E, Right arrow → `AcceptSuggestion` handler inserts entire suggestion text
  - Partial word-segment acceptance: Escape+F → `AcceptPartialSuggestion` handler inserts first word/path segment (Emacs mode only)
  - `SuggestionAvailable` private filter: non-null suggestion, non-empty text, cursor at end of buffer
  - Word boundary regex `([^\s/]+(?:\s+|/))` matching Python's `re.split` behavior for whitespace and path separator boundaries
  - Must load after Vi bindings for correct Right arrow priority override
  - Stateless, thread-safe (21 tests, >80% coverage)

- **Focus & CPR Bindings** — Focus navigation and cursor position report response handling
  - `FocusFunctions` static class with `FocusNext` and `FocusPrevious` handler functions
  - Focus navigation cycles through visible focusable windows via `Layout.FocusNext()`/`FocusPrevious()`
  - Wrap-around behavior: last→first (forward), first→last (backward)
  - Graceful no-ops for single-window and zero-focusable-window layouts
  - `CprBindings` static class with `LoadCprBindings()` factory method
  - CPR escape sequence parsing: `\x1b[row;colR` → row/col extraction via `Data[2..^1].Split(';')`
  - Reports parsed row to `Renderer.ReportAbsoluteCursorRow()` for accurate screen positioning
  - `saveBefore` disabled (CPR responses are terminal state reports, not user actions)
  - Stateless, thread-safe (12 tests, >80% coverage)

- **Open in Editor Bindings** — Key bindings for opening the current buffer in an external editor
  - `OpenInEditorBindings` static class with 3 binding loaders ported from `open_in_editor.py`
  - `LoadEmacsOpenInEditorBindings()` — Ctrl-X Ctrl-E with `EmacsMode & ~HasSelection` per-binding filter
  - `LoadViOpenInEditorBindings()` — `'v'` with `ViNavigationMode` per-binding filter
  - `LoadOpenInEditorBindings()` — combined via `MergedKeyBindings` (no outer `ConditionalKeyBindings`, matching Python source)
  - Delegates to `edit-and-execute-command` named command → `Buffer.OpenInEditorAsync(validateAndHandle: true)`
  - Stateless, thread-safe (14 tests, >80% coverage)

- **Emacs Key Bindings** — Full Emacs editing mode with 112 key bindings (78 core + 34 shift-selection)
  - `LoadEmacsBindings()` — 78 core bindings across movement, editing, kill ring, completion, selection, numeric args, word case
  - Movement: Ctrl-A/E/F/B, Meta-F/B, arrow keys, sentence navigation, character search (Ctrl-]/Ctrl-Meta-])
  - Editing: undo (Ctrl-_), transpose (Ctrl-T), word case (Meta-U/L/C uppercase/lowercase/capitalize)
  - Kill ring: Ctrl-K/U/W, Meta-D/Backspace, yank (Ctrl-Y) with rotate (Meta-Y)
  - Completion: Tab, Meta-?, insert-all-completions (Meta-*)
  - Selection: Ctrl-Space start, Ctrl-W/Meta-W cut/copy, Ctrl-G cancel with validation dismiss
  - Numeric args: Meta-0..9 digit accumulation, Meta-dash negative prefix
  - Escape consumed as silent no-op to prevent passthrough to Vi mode
  - `LoadEmacsShiftSelectionBindings()` — 34 shift-selection bindings for Windows-style Shift+movement selection
  - 10 start-selection bindings (Shift+arrows/Home/End/Ctrl-Shift, filter: ~has_selection)
  - 10 extend-selection bindings (filter: shift_selection_mode)
  - 4 replace/cancel bindings (Any, Ctrl-M newline, Ctrl-H delete, Ctrl-Y yank)
  - 10 cancel-movement bindings (unshifted keys re-fed via KeyProcessor)
  - `Buffer.DismissValidation()` for clearing validation error state on Ctrl-G cancel
  - All bindings gated on `EmacsFilters.EmacsMode` via `ConditionalKeyBindings`
  - Stateless, thread-safe (149 tests, >80% coverage)

- **Vi Key Bindings** — Complete Vi editing mode with all bindings
  - `ViBindings` static partial class split across 8 source files (~300 bindings total)
  - `LoadViBindings()` returns `ConditionalKeyBindings` gated on `ViFilters.ViMode`
  - `RegisterOperator` helper: creates navigation-mode (set pending) + selection-mode (execute) bindings per operator
  - `RegisterTextObject` helper: creates up to 3 bindings per text object (operator-pending, navigation, selection)
  - Navigation: h/l/j/k/w/b/e/W/B/E/0/$, gg/G/H/M/L, f/F/t/T/;/,, {/}/%/^, arrows, +/-, n/N/#/*
  - Operators: d/c/y/>/< with doubled-key variants (dd/yy/cc/>>/<</Y/S/C/D), g,q reshape, g,?/g,u/g,U/g,~/~ transforms
  - Text objects: iw/aw/iW/aW, i"/a"/i'/a'/i`/a`, i(/a(/i[/a[/i{/a{/i</a< with aliases (b/B)
  - Mode switch: Escape, i/I/a/A/o/O, v/V/Ctrl-V, r/R, Insert toggle
  - Visual mode: j/k extend, x cut, J/g,J join, v/V/Ctrl-V toggle, I/A block, a,w/a,W auto-word
  - Insert mode: Ctrl-V quoted-insert, Ctrl-N/P completion, Ctrl-T/D indent, Ctrl-K digraph, replace/insert-multiple
  - Misc: p/P paste, register-aware paste, u/Ctrl-R undo/redo, q/@/. macros, Ctrl-A/X increment, z scroll, Ctrl-O temp nav
  - Stateless, thread-safe (204 tests, >80% coverage)

- **Toolbar Widgets** — 7 toolbar components ported from Python Prompt Toolkit's `widgets/toolbars.py`
  - `FormattedTextToolbar` — Window subclass displaying styled text with lazy evaluation
  - `SystemToolbar` — Shell command toolbar with Emacs/Vi/global key bindings, async execution via `RunSystemCommandAsync`, `IMagicContainer` protocol
  - `ArgToolbar` — Numeric repeat argument display ("Repeat: N") with `HasArg` conditional visibility and "-" → "-1" conversion
  - `SearchToolbar` — Incremental search with direction-aware prompts ("I-search: " / "I-search backward: " or "/" / "?" in Vi mode), `SearchBufferControl` with `BeforeInput` processor
  - `CompletionsToolbarControl` — Internal `IUIControl` with horizontal pagination, arrow indicators, current-item highlighting
  - `CompletionsToolbar` — Public `IMagicContainer` wrapper with `HasCompletions` conditional visibility
  - `ValidationToolbar` — Validation error display with optional line/column position formatting
  - `SearchBufferControl` extended with `inputProcessors` parameter for toolbar integration
  - All toolbars use `ConditionalContainer` with appropriate `AppFilters` for visibility control
  - 12 style classes matching Python Prompt Toolkit exactly
  - Thread-safe via immutable construction patterns (152 tests, >80% coverage)

- **Base Widgets** — 15 reusable widget classes ported from Python Prompt Toolkit's `widgets/base.py` and `widgets/dialogs.py`
  - `Border` — Static class with 6 Unicode box-drawing constants (─ │ ┌ ┐ └ ┘)
  - `Label` — Non-focusable text display with auto-calculated width via `UnicodeWidth.GetWidth()`
  - `Button` — Clickable widget with Enter/Space/mouse handlers, focus-based styling, centered text
  - `Frame` — Border decorator with optional title using `Template`-based formatting, `ConditionalContainer` title switching
  - `Shadow` — Visual depth effect using `FloatContainer` with 2 transparent overlay `Float` windows
  - `Box` — Padding container with per-side fallback logic (HSplit/VSplit composition)
  - `TextArea` — Full-featured text input (22 constructor parameters) wrapping Buffer + BufferControl + Window
  - `ProgressBar` — Thread-safe percentage bar with `FloatContainer` and weighted `VSplit` proportional rendering
  - `VerticalLine` / `HorizontalLine` — Simple line widgets using Border constants
  - `DialogList<T>` — Generic selection base class with thread-safe Lock, 8 key binding groups, mouse handlers
  - `RadioList<T>` — Single-selection list (always `multipleSelection=false`)
  - `CheckboxList<T>` — Multi-selection list (always `multipleSelection=true`)
  - `Checkbox` — Convenience wrapper creating a 1-item `CheckboxList<string>`
  - `Dialog` — Composed dialog window (Frame + Shadow + Box + Buttons) with Tab/Shift-Tab focus cycling
  - All widgets implement `IMagicContainer` for container protocol integration
  - Thread-safe mutable state in DialogList and ProgressBar via `System.Threading.Lock`
  - 141 new widget tests (8,015 total tests, >80% coverage)

- **Shortcut Utilities** — High-level print and terminal control functions ported from `shortcuts/utils.py`
  - `FormattedTextOutput.Print` — Single-value and multi-value overloads with `sep`/`end`/`file`/`flush`/`style`/`output`/`colorDepth`/`styleTransformation`/`includeDefaultPygmentsStyle` parameters
  - `FormattedTextOutput.PrintContainer` — One-shot container rendering using temporary `Application` with `DummyInput` → `EndOfStreamException` termination
  - `TerminalUtils.Clear` — Erase screen + cursor home + flush
  - `TerminalUtils.SetTitle` / `ClearTitle` — VT100 window title control
  - Style merging: DefaultUI → Pygments → user style precedence via `StyleMerger.MergeStyles`
  - Running-app dispatch: auto-routes through `RunInTerminal.RunAsync` when `Application` is active
  - 32 new tests (8,051 total tests, >80% coverage)

- **Prompt Session** — High-level `PromptSession` API ported from `shortcuts/prompt.py`
  - `PromptSession<TResult>` generic class with 44-parameter constructor covering all Python Prompt Toolkit options
  - `Prompt()` and `PromptAsync()` with per-prompt permanent overrides (38 parameter parity with Python)
  - `Prompt` static class: `Prompt`, `PromptAsync`, `Confirm`, `ConfirmAsync`, `CreateConfirmSession`
  - `CompleteStyle` enum (Column, MultiColumn, ReadlineLike) for completion menu display modes
  - Layout construction: `FloatContainer` + `HSplit` + completion menus + toolbars + conditional containers
  - `SplitMultilinePrompt` for multi-line prompt rendering (before/after newline splitting)
  - DynCond pattern: `Condition` lambdas closing over session for reactive Lock-protected `FilterOrBool` property reads
  - `CompleteWhileTyping` condition composition: `completeWhileTyping & ~enableHistorySearch & ~ReadlineLike`
  - Dumb terminal fallback via `PlatformUtils.IsDumbTerminal()` with Console.ReadLine degradation
  - Default value and accept-default logic with `ResolveDefaultDocument()`
  - Prompt key bindings: Enter (accept), Ctrl-C (abort), Ctrl-D (EOF), Tab (complete), Ctrl-Z (suspend)
  - Confirm session with y/n/Y/N key bindings and configurable suffix
  - `KeyboardInterruptException` and `EOFException` for signal-like prompt termination
  - Thread-safe via `System.Threading.Lock` on all 36 mutable properties
  - Partial class split across 6 files (max 548 LOC, Constitution X compliant)
  - 173 new tests (8,224 total tests, >80% coverage)

- **Dialog Shortcuts** — Pre-built dialog shortcut functions ported from `shortcuts/dialogs.py`
  - `Dialogs` static class with 7 factory methods and 7 async wrappers
  - `YesNoDialog` — Yes/No confirmation returning `Application<bool>`
  - `MessageDialog` — Simple message box returning `Application<object?>`
  - `InputDialog` — Text input with validation, completion, password masking returning `Application<string?>`
  - `ButtonDialog<T>` — Generic button choices returning `Application<T>`
  - `RadioListDialog<T>` — Single-selection radio list returning `Application<T?>`
  - `CheckboxListDialog<T>` — Multi-selection checkbox list returning `Application<IReadOnlyList<T>?>`
  - `ProgressDialog` — Background task with thread-safe progress bar and log area
  - `CreateApp<T>` private helper with Tab/Shift-Tab focus cycling and merged key bindings
  - All dialogs compose Dialog widget with `withBackground: true`
  - Thread-safe `ProgressDialog` via Lock-protected `setPercentage` and `_actionChannel`-marshaled `logText`
  - 47 new tests (8,271 total tests, >80% coverage)

- **Choice Input** — Selection prompt shortcut ported from `shortcuts/choice_input.py`
  - `ChoiceInput<T>` sealed class with 12-parameter constructor for full configuration
  - `Prompt()` and `PromptAsync()` methods returning selected value
  - `Dialogs.Choice<T>()` and `Dialogs.ChoiceAsync<T>()` convenience methods
  - `KeyboardInterrupt` exception for Ctrl+C cancellation (configurable)
  - RadioList-based UI with numbered options (1-9 direct selection)
  - Arrow key and k/j navigation with wrap-around
  - Optional frame border, bottom toolbar, mouse support
  - Ctrl+Z suspend on Unix (when enabled)
  - Key binding extensibility via MergedKeyBindings
  - Thread-safe via immutable configuration (47 tests, >80% coverage)

- **Patch Stdout** — Console output interception for active prompt sessions, ported from `patch_stdout.py`
  - `StdoutProxy` sealed `TextWriter` subclass with newline-gated buffering and producer-consumer flush thread
  - `StdoutPatching.PatchStdout()` replaces `Console.Out` and `Console.Error` with proxy, returns `IDisposable` for restore
  - `FlushItem` internal sealed record hierarchy (Text/Done) for type-safe queue sentinel pattern
  - `BlockingCollection<FlushItem>` queue with dedicated `Thread(IsBackground=true)` consumer
  - `RunInTerminal.RunAsync` integration: suspends renderer during output when app is running
  - Raw mode (`raw: true`) passes VT100 escape sequences through `IOutput.WriteRaw()` unmodified
  - Non-raw mode (default) routes through `IOutput.Write()` which escapes 0x1B → '?'
  - `EnableAutowrap()` called before each write (Windows VT processing workaround)
  - Configurable `SleepBetweenWrites` (default 200ms) for batching rapid writes
  - Nesting support: multiple `PatchStdout()` calls stack correctly
  - Thread-safe via `System.Threading.Lock` for buffer access (55 tests, >80% coverage)

- **Progress Bar Shortcut** — Full-featured progress tracking API ported from `shortcuts/progress_bar/`
  - `ProgressBar` (`IAsyncDisposable`) with background UI thread, configurable formatters, title, bottom toolbar
  - `Iterate<T>()` wraps any `IEnumerable<T>` with automatic progress tracking and optional label
  - `ProgressBarCounter<T>` generic iteration tracker with `Percentage`, `TimeElapsed`, `TimeLeft`, `ItemsCompleted`, `Done`, `Stopped`
  - `ProgressBarCounter` non-generic view via delegate proxy for formatter consumption
  - 10 formatter classes: `Text`, `Label` (with scrolling), `Percentage`, `Bar`, `Progress`, `TimeElapsed`, `TimeLeft`, `IterationsPerSecond`, `SpinningWheel`, `Rainbow`
  - `FormatterUtils.CreateDefaultFormatters()` for standard layout, `FormatTimeDelta` for time display
  - `Bar` formatter handles known total (filled bar), unknown total (bouncing animation), and done state
  - `Rainbow` decorator wraps any formatter with cycling hue-shifted colors
  - `ProgressControl` internal `IUIControl` rendering all counters via formatter columns
  - Total inference from `ICollection<T>` / `IReadOnlyCollection<T>`, explicit override, or null for generators
  - Cancel support via SIGINT (P/Invoke `kill`/`GenerateConsoleCtrlEvent`) matching Python's `os.kill`
  - Multiple concurrent counters with `RemoveWhenDone` auto-cleanup
  - Thread-safe via `System.Threading.Lock` (98 tests, >80% coverage)

- **Event Loop Utilities** — Context-preserving background execution and thread-safe callback scheduling, ported from `eventloop/utils.py`
  - `EventLoopUtils` static class with 3 public methods + 2 private helpers
  - `RunInExecutorWithContextAsync<T>` and void overload — `ExecutionContext.Capture()`/`Run()` for `AsyncLocal<T>` preservation across thread pool dispatch
  - `CallSoonThreadSafe` — `SynchronizationContext.Post` with optional deadline-based re-post coalescing via `Environment.TickCount64`
  - `GetTracebackFromContext` — Exception stack trace extraction from `IDictionary<string, object?>` context
  - Overflow clamping for `TimeSpan.MaxValue` deadlines, disposed sync context fallback, suppressed flow handling
  - Stateless, thread-safe (34 tests, >80% coverage)
- **Async Generator Utilities** — Safe async generator cleanup and sync-to-async conversion, ported from `eventloop/async_generator.py`
  - `AsyncGeneratorUtils` static class with `Aclosing<T>()` and `GeneratorToAsyncGenerator<T>()`
  - `Aclosing<T>()` wraps async generators in `IAsyncDisposableValue<T>` ensuring `DisposeAsync()` on early exit or exception
  - `GeneratorToAsyncGenerator<T>()` converts sync `IEnumerable<T>` to `IAsyncEnumerable<T>` with backpressure
  - Bounded `BlockingCollection<T>` buffer (default 1000) with producer blocking when full
  - Lazy producer thread startup on `GetAsyncEnumerator()` call
  - Cooperative cancellation via `volatile bool` flag with 1-second timeout TryAdd
  - Exception propagation from producer to consumer on next `MoveNextAsync()`
  - Producer terminates within 2 seconds of disposal under all conditions
  - Thread-safe (24 tests, >80% coverage)
- **Win32 Console Types** — P/Invoke struct types and enums for Windows Console API interop, ported from `win32_types.py`
  - `Stroke.Input.Windows.Win32Types` namespace with 17 type files
  - 11 structs: `Coord` (4B), `SmallRect` (8B), `CharInfo` (4B), `KeyEventRecord` (16B), `MouseEventRecord` (16B), `WindowBufferSizeRecord` (4B), `MenuEventRecord` (4B), `FocusEventRecord` (4B), `InputRecord` union (20B, `LayoutKind.Explicit`), `ConsoleScreenBufferInfo` (22B), `SecurityAttributes` (12/24B)
  - 6 flags enums: `EventType`, `ControlKeyState`, `MouseEventFlags`, `MouseButtonState`, `ConsoleInputMode`, `ConsoleOutputMode`
  - `StdHandles` static class with STD_INPUT/OUTPUT/ERROR_HANDLE constants
  - 4 new `ConsoleApi` P/Invoke methods: `GetConsoleScreenBufferInfo`, `ReadConsoleInput`, `WriteConsoleOutput`, `SetConsoleCursorPosition`
  - `LibraryImport` source generator with unsafe pointer pinning for blittable array marshalling
  - Cross-platform compilation (types compile everywhere; P/Invoke Windows-only via `[SupportedOSPlatform]`)
  - Thread-safe via immutable value types (142 tests, 100% struct size verification)

- **Win32 Console Output** — Windows Console API-based `IOutput` implementation for legacy terminals, ported from `win32.py`
  - `Win32Output` sealed class implementing all 30+ `IOutput` methods via kernel32.dll P/Invoke
  - Direct cursor control: `SetConsoleCursorPosition`, `GetConsoleCursorInfo`, `SetConsoleCursorInfo`
  - 16-color (4-bit) palette via `FillConsoleOutputAttribute` and `SetConsoleTextAttribute`
  - `ColorLookupTable` thread-safe mapper: 17 ANSI colors + Euclidean RGB distance matching to closest palette entry
  - `ForegroundColor` / `BackgroundColor` static classes with Win32 attribute constants (bits 0-3, 4-7)
  - Alternate screen buffer via `CreateConsoleScreenBuffer` + `SetConsoleActiveScreenBuffer`
  - Screen erase: `FillConsoleOutputCharacter` + `FillConsoleOutputAttribute` for clear operations
  - Character-by-character `WriteConsoleW` rendering (Windows Console bug workaround)
  - `NoConsoleScreenBufferError` context-aware exception with xterm/winpty detection
  - `ConsoleCursorInfo` struct with uint-based Visible field for P/Invoke compatibility
  - Thread-safe via `System.Threading.Lock` on mutable buffer state (67 tests, >80% coverage)

- **ConEmu Output** — Hybrid `IOutput` implementation for ConEmu/Cmder terminals, ported from `conemu.py`
  - `ConEmuOutput` sealed class combining `Win32Output` and `Vt100Output` via delegation
  - Win32Output handles: `GetSize`, `GetRowsBelowCursorPosition`, mouse support, scrolling, bracketed paste
  - Vt100Output handles: all rendering (cursor movement, colors, text output, screen control)
  - Enables 256-color and true-color support in ConEmu/Cmder while maintaining accurate console sizing
  - `RespondsToCpr` always returns `false` (CPR not needed on Windows)
  - Public `Win32Output` and `Vt100Output` properties for advanced access to underlying outputs
  - Detection via `PlatformUtils.IsConEmuAnsi` checking `ConEmuANSI=ON` (case-sensitive)
  - `[SupportedOSPlatform("windows")]` attribute for platform safety
  - Thread-safe via delegation to thread-safe underlying outputs (19 tests, >80% coverage)

- **Win32 Event Loop Utilities** — Windows-specific event loop primitives, ported from `eventloop/win32.py`
  - `Win32EventLoopUtils` static class with 2 constants + 6 public methods
  - `WaitForHandles` synchronous multiplexed wait returning signaled handle or `null` on timeout
  - `WaitForHandlesAsync` async version with 100ms polling loop and `CancellationToken` support
  - `CreateWin32Event` / `SetWin32Event` / `ResetWin32Event` / `CloseWin32Event` for manual-reset event lifecycle
  - `WaitTimeout` (0x00000102) and `Infinite` (-1) constants matching Python Prompt Toolkit
  - `ArgumentOutOfRangeException` for >64 handles (MAXIMUM_WAIT_OBJECTS limit)
  - `Win32Exception` on API failure with `Marshal.GetLastWin32Error()` error codes
  - `[SupportedOSPlatform("windows")]` attribute for platform safety
  - Thread-safe via stateless design (24 tests, >80% coverage)

- **Windows 10 VT100 Output** — Hybrid `IOutput` implementation for Windows 10+ consoles, ported from `windows10.py`
  - `Windows10Output` sealed class combining `Win32Output` and `Vt100Output` via delegation
  - Enables VT100 escape sequences by temporarily setting `ENABLE_VIRTUAL_TERMINAL_PROCESSING` during flush
  - Win32Output handles: `GetSize`, `GetRowsBelowCursorPosition`, mouse support, scrolling, bracketed paste
  - Vt100Output handles: all rendering (cursor movement, colors, text output, screen control)
  - Per-flush mode switching: save original mode → enable VT100 (0x0005) → flush → restore original mode
  - Per-instance `Lock` (.NET 9+) for thread-safe flush serialization
  - Default color depth: 24-bit true color (Windows 10 support since 2016)
  - `WindowsVt100Support.IsVt100Enabled()` detection delegating to `PlatformUtils.IsWindowsVt100Supported`
  - `[SupportedOSPlatform("windows")]` attribute for platform safety
  - Thread-safe via per-instance lock on flush operations (36 tests, >80% coverage)
- **Telnet Server** — Network-accessible REPL support ported from `contrib/telnet/`
  - `TelnetServer` class with host/port/interact/encoding/style/enableCpr configuration
  - `RunAsync()` with ready callback and cancellation token for graceful shutdown
  - `Connections` property returning snapshot of active connections
  - Connection lifecycle: accept → negotiate → interact → cleanup (5-second shutdown timeout)
  - `TelnetConnection` with Send/SendAbovePrompt/EraseScreen/Close methods
  - NAWS (Negotiate About Window Size) parsing with dimension clamping (1-500)
  - TTYPE (Terminal Type) negotiation with 500ms timeout and VT100 fallback
  - `TelnetProtocolParser` state machine (5 states) with IAC escaping and subnegotiation
  - `ConnectionStdout` TextWriter with LF→CRLF conversion per telnet NVT specification
  - `TelnetConstants` with 20+ protocol constants (IAC, DO, WILL, SB, SE, NAWS, TTYPE, etc.)
  - 4 telnet examples: `hello-world`, `chat-app`, `dialog`, `toolbar`
  - Thread-safe via Lock and ConcurrentDictionary (208 tests, >80% coverage)
- **Logging Infrastructure** — Central logging facility ported from `log.py`
  - `StrokeLogger` static class with `Logger` singleton property
  - `Configure(ILoggerFactory)` for provider setup (console, file, Serilog, etc.)
  - `CreateLogger<T>()` and `CreateLogger(string)` for component-specific loggers
  - `NullLoggerFactory` default for zero performance impact when disabled
  - Integrated into telnet classes for protocol debugging
  - Thread-safe via `System.Threading.Lock` (26 tests, >80% coverage)
- **SSH Server** — Secure network-accessible REPL support using FxSsh, ported from `contrib/ssh/`
  - `StrokeSshServer` class with host/port/interact/hostKeyPath/encoding/style/enableCpr configuration
  - `RunAsync()` with ready callback and cancellation token for graceful shutdown (5-second timeout)
  - `Connections` property returning snapshot of active sessions
  - `BeginAuth()` virtual method for custom authentication (defaults to no auth)
  - `CreateSession()` virtual method for custom session types
  - `StrokeSshSession` with GetSize/DataReceived/TerminalSizeChanged/Close methods
  - `ISshChannel` abstraction for testability with `SshChannel` FxSsh adapter
  - `SshChannelStdout` TextWriter with LF→CRLF conversion per NVT specification
  - Terminal type and size tracking from PTY request
  - asyncssh-server example: progress dialog, prompts, autocompletion, dialogs
  - Thread-safe via Lock and ConcurrentDictionary (80 tests, >80% coverage)

### Up Next

- **Examples** — Port of Python Prompt Toolkit examples (126/129 complete)
  - `accept-default` — Prompt with default value auto-accepted (`Stroke.Examples.Prompts`)
  - `async-prompt` — Async prompt with background tasks (`Stroke.Examples.Prompts`)
  - `auto-suggestion` — Fish-style auto-suggestion from history (`Stroke.Examples.Prompts`)
  - `autocompletion` — Tab completion with WordCompleter (`Stroke.Examples.Prompts`)
  - `autocorrection` — Auto-correct common typos via key bindings (`Stroke.Examples.Prompts`)
  - `bottom-toolbar` — Prompt with bottom toolbar display (`Stroke.Examples.Prompts`)
  - `clock-input` — Prompt with live clock in toolbar (`Stroke.Examples.Prompts`)
  - `colored-prompt` — Prompt with ANSI-colored prompt text (`Stroke.Examples.Prompts`)
  - `confirmation-prompt` — Yes/no confirmation prompt (`Stroke.Examples.Prompts`)
  - `cursor-shapes` — Different cursor shapes per editing mode (`Stroke.Examples.Prompts`)
  - `custom-key-binding` — Custom key bindings with prompt (`Stroke.Examples.Prompts`)
  - `custom-lexer` — Prompt with custom syntax highlighting (`Stroke.Examples.Prompts`)
  - `custom-vi-operator` — Custom Vi operator implementation (`Stroke.Examples.Prompts`)
  - `enforce-tty-input-output` — Force TTY even when redirected (`Stroke.Examples.Prompts`)
  - `fancy-zsh-prompt` — Multi-segment Zsh-style prompt (`Stroke.Examples.Prompts`)
  - `fuzzy-word-completer` — Auto-completion while typing with fuzzy matching (`Stroke.Examples.Prompts`)
  - `get-input` — Simple single-line prompt (`Stroke.Examples.Prompts`)
  - `get-input-vi-mode` — Single-line prompt with Vi editing mode (`Stroke.Examples.Prompts`)
  - `get-input-with-default` — Prompt pre-filled with default text (`Stroke.Examples.Prompts`)
  - `get-multiline-input` — Multi-line text input (`Stroke.Examples.Prompts`)
  - `get-password` — Password input with hidden characters (`Stroke.Examples.Prompts`)
  - `get-password-with-toggle` — Password with visibility toggle (`Stroke.Examples.Prompts`)
  - `history/persistent-history` — File-backed command history (`Stroke.Examples.Prompts`)
  - `history/slow-history` — History with simulated slow loading (`Stroke.Examples.Prompts`)
  - `html-input` — Prompt with HTML-styled formatted text (`Stroke.Examples.Prompts`)
  - `input-validation` — Input validation with error messages (`Stroke.Examples.Prompts`)
  - `mouse-support` — Prompt with mouse click support (`Stroke.Examples.Prompts`)
  - `multiline-autosuggest` — Auto-suggestion in multiline mode (`Stroke.Examples.Prompts`)
  - `multiline-prompt` — Multi-line prompt with line continuations (`Stroke.Examples.Prompts`)
  - `no-wrapping` — Prompt without line wrapping (`Stroke.Examples.Prompts`)
  - `operate-and-get-next` — Readline operate-and-get-next behavior (`Stroke.Examples.Prompts`)
  - `patch-stdout` — Background output while prompt is active (`Stroke.Examples.Prompts`)
  - `placeholder-text` — Prompt with grayed placeholder text (`Stroke.Examples.Prompts`)
  - `regular-language` — Completion from formal grammar (`Stroke.Examples.Prompts`)
  - `right-prompt` — Right-aligned prompt text (`Stroke.Examples.Prompts`)
  - `shell-integration` — Terminal shell integration sequences (`Stroke.Examples.Prompts`)
  - `swap-light-dark-colors` — Toggle light/dark color scheme (`Stroke.Examples.Prompts`)
  - `switch-vi-emacs` — Toggle between Vi and Emacs modes (`Stroke.Examples.Prompts`)
  - `system-clipboard` — Emacs-style clipboard integration with OS clipboard (`Stroke.Examples.Prompts`)
  - `system-prompt` — System-level prompt integration (`Stroke.Examples.Prompts`)
  - `terminal-title` — Set terminal window title (`Stroke.Examples.Prompts`)
  - `up-arrow-partial-match` — History search by prefix with up arrow (`Stroke.Examples.Prompts`)
  - `with-frames/basic-frame` — Prompt wrapped in a frame border (`Stroke.Examples.Prompts`)
  - `with-frames/frame-with-completion` — Framed prompt with completion menu (`Stroke.Examples.Prompts`)
  - `with-frames/gray-frame-on-accept` — Frame that grays out on accept (`Stroke.Examples.Prompts`)
  - `auto-completion/colored-completions` — Completions with colored display text (`Stroke.Examples.Prompts`)
  - `auto-completion/control-space-trigger` — Manual completion trigger with Ctrl+Space (`Stroke.Examples.Prompts`)
  - `auto-completion/formatted-completions` — Completions with formatted meta text (`Stroke.Examples.Prompts`)
  - `auto-completion/fuzzy-custom-completer` — Fuzzy matching with custom completer (`Stroke.Examples.Prompts`)
  - `auto-completion/merged-completers` — Multiple merged completion sources (`Stroke.Examples.Prompts`)
  - `auto-completion/multi-column` — Multi-column completion menu layout (`Stroke.Examples.Prompts`)
  - `auto-completion/multi-column-with-meta` — Multi-column completions with metadata (`Stroke.Examples.Prompts`)
  - `auto-completion/nested-completion` — Hierarchical nested completion (`Stroke.Examples.Prompts`)
  - `auto-completion/readline-style` — Readline-style inline completion (`Stroke.Examples.Prompts`)
  - `auto-completion/slow-completions` — Async completions with loading indicator (`Stroke.Examples.Prompts`)
  - `hello-world` — Basic telnet prompt (`Stroke.Examples.Telnet`)
  - `chat-app` — Multi-client chat server (`Stroke.Examples.Telnet`)
  - `dialog` — Yes/No dialog demo (`Stroke.Examples.Telnet`)
  - `toolbar` — Bottom toolbar with completions (`Stroke.Examples.Telnet`)
  - `asyncssh-server` — SSH server with prompts, dialogs, autocompletion (`Stroke.Examples.Ssh`)
  - `simple-selection` — Basic choice selection with arrow keys (`Stroke.Examples.Choices`)
  - `default` — Pre-selected default option (`Stroke.Examples.Choices`)
  - `color` — Styled options with HTML formatting (`Stroke.Examples.Choices`)
  - `with-frame` — Framed choice dialog with title (`Stroke.Examples.Choices`)
  - `frame-and-bottom-toolbar` — Framed choice with bottom toolbar (`Stroke.Examples.Choices`)
  - `gray-frame-on-accept` — Dynamic styling on selection (`Stroke.Examples.Choices`)
  - `many-choices` — Scrollable list with many options (`Stroke.Examples.Choices`)
  - `mouse-support` — Mouse click selection support (`Stroke.Examples.Choices`)
  - `button-dialog` — Multiple button options (`Stroke.Examples.Dialogs`)
  - `checkbox-dialog` — Multi-select checkbox list (`Stroke.Examples.Dialogs`)
  - `input-dialog` — Text input dialog (`Stroke.Examples.Dialogs`)
  - `message-box` — Simple message box (`Stroke.Examples.Dialogs`)
  - `password-dialog` — Password input dialog (`Stroke.Examples.Dialogs`)
  - `progress-dialog` — Background task progress (`Stroke.Examples.Dialogs`)
  - `radio-dialog` — Single-select radio list (`Stroke.Examples.Dialogs`)
  - `styled-message-box` — Styled message box (`Stroke.Examples.Dialogs`)
  - `yes-no-dialog` — Boolean confirmation (`Stroke.Examples.Dialogs`)
  - `hello-world` — Minimal full-screen app (`Stroke.Examples.FullScreen`)
  - `calculator` — Interactive calculator layout (`Stroke.Examples.FullScreen`)
  - `buttons` — Button widgets with key bindings (`Stroke.Examples.FullScreen`)
  - `text-editor` — Multi-buffer text editor with syntax highlighting (`Stroke.Examples.FullScreen`)
  - `pager` — Scrollable text viewer (`Stroke.Examples.FullScreen`)
  - `split-screen` — Side-by-side text areas (`Stroke.Examples.FullScreen`)
  - `full-screen-demo` — Feature showcase with menus and completion (`Stroke.Examples.FullScreen`)
  - `dummy-app` — Minimal no-op application (`Stroke.Examples.FullScreen`)
  - `no-layout` — Application without layout container (`Stroke.Examples.FullScreen`)
  - `ansi-art-and-textarea` — ANSI art rendering with text area (`Stroke.Examples.FullScreen`)
  - `alignment` — Content alignment in windows (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `auto-completion` — Completion menu in full-screen layout (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `color-column` — Color column indicator (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `cursor-highlight` — Cursor line/column highlighting (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `floats` — Floating window overlays (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `float-transparency` — Transparent floating windows (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `focus` — Focus switching between panes (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `horizontal-align` — Horizontal content alignment (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `horizontal-split` — Horizontal split layout (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `line-prefixes` — Line prefix rendering (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `margins` — Numbered and scrollbar margins (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `vertical-align` — Vertical content alignment (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `vertical-split` — Vertical split layout (`Stroke.Examples.FullScreen/SimpleDemos`)
  - `simple-example` — Basic scrollable pane (`Stroke.Examples.FullScreen/ScrollablePanes`)
  - `with-completion-menu` — Scrollable pane with completion menu (`Stroke.Examples.FullScreen/ScrollablePanes`)
  - `simple-progress-bar` — Basic progress bar with default formatters (`Stroke.Examples.ProgressBar`)
  - `two-tasks` — Two parallel progress bars (`Stroke.Examples.ProgressBar`)
  - `unknown-length` — Generator iteration without known total (`Stroke.Examples.ProgressBar`)
  - `nested-progress-bars` — Hierarchical nested progress bars (`Stroke.Examples.ProgressBar`)
  - `styled-1` — Custom styled progress bar with spinning wheel (`Stroke.Examples.ProgressBar`)
  - `styled-2` — Custom formatters with HTML tildes and spinning wheel (`Stroke.Examples.ProgressBar`)
  - `styled-rainbow` — Rainbow-colored progress bar with color depth prompt (`Stroke.Examples.ProgressBar`)
  - `styled-apt-get` — apt-get install style progress bar (`Stroke.Examples.ProgressBar`)
  - `styled-tqdm-1` — tqdm-style with iterations per second (`Stroke.Examples.ProgressBar`)
  - `styled-tqdm-2` — tqdm-style with reverse-video bar (`Stroke.Examples.ProgressBar`)
  - `colored-title-label` — HTML-styled title and label colors (`Stroke.Examples.ProgressBar`)
  - `custom-key-bindings` — Key bindings within progress bar context (`Stroke.Examples.ProgressBar`)
  - `many-parallel-tasks` — 8 concurrent parallel progress bars (`Stroke.Examples.ProgressBar`)
  - `lot-of-parallel-tasks` — 160 parallel tasks with random completion (`Stroke.Examples.ProgressBar`)
  - `scrolling-task-name` — Scrolling label text on progress bars (`Stroke.Examples.ProgressBar`)
  - `ansi-colors` — 16 ANSI color output (`Stroke.Examples.PrintText`)
  - `pygments-tokens` — Syntax highlighting with Pygments tokens (`Stroke.Examples.PrintText`)
  - `html` — HTML-formatted text output (`Stroke.Examples.PrintText`)
  - `named-colors` — Named color palette display (`Stroke.Examples.PrintText`)
  - `true-color-demo` — 24-bit color gradient rendering (`Stroke.Examples.PrintText`)
  - `ansi` — ANSI escape sequence text output (`Stroke.Examples.PrintText`)
  - `print-frame` — Container printing with Frame widget (`Stroke.Examples.PrintText`)
  - `print-formatted-text` — Multiple formatted text output methods (`Stroke.Examples.PrintText`)
  - `logo-ansi-art` — Prompt Toolkit ANSI art logo rendering (`Stroke.Examples.PrintText`)
  - Remaining: 3 examples (Prompts/InputHook, Tutorial/SqliteCli, Standalone/AsyncEventLoop)

## Requirements

- .NET 10 SDK

## Building

```bash
dotnet build
dotnet test
```

## Benchmarks

Performance benchmarks using BenchmarkDotNet:

```bash
dotnet run -c Release --project benchmarks/Stroke.Benchmarks
```

## License

MIT
