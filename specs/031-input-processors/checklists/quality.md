# Requirements Quality Checklist: Input Processors

**Purpose**: Validate completeness, clarity, consistency, measurability, and coverage of all requirements across spec, contracts, and data model
**Created**: 2026-01-29
**Feature**: [spec.md](../spec.md)
**Focus**: Full requirements quality (standard depth)
**Audience**: Reviewer (pre-implementation gate)
**Status**: All items resolved (2026-01-29)

## Requirement Completeness

- [x] CHK001 - Are all 20+ processor types from Python's `processors.py` accounted for in spec FR list? [Completeness, Spec §FR-001 through FR-037] — **Pass.** All 20+ types mapped in FRs: IProcessor (FR-001), TransformationInput (FR-002), Transformation (FR-003), DummyProcessor (FR-004), PasswordProcessor (FR-005), HighlightSearchProcessor (FR-006/007/008), HighlightIncrementalSearchProcessor (FR-009), HighlightSelectionProcessor (FR-010/011/012), BeforeInput (FR-013/014), AfterInput (FR-015/016), ShowArg (FR-017), AppendAutoSuggestion (FR-018), TabsProcessor (FR-019/020), ShowLeadingWhiteSpaceProcessor (FR-021), ShowTrailingWhiteSpaceProcessor (FR-022), HighlightMatchingBracketProcessor (FR-023/024/025/026), DisplayMultipleCursors (FR-027), ConditionalProcessor (FR-028), DynamicProcessor (FR-029), MergeProcessors/_MergedProcessor (FR-030/031), ReverseSearchProcessor (FR-032/033), fragment explosion (FR-034/035), DefaultInputProcessors (FR-036), excluded types (FR-037).
- [x] CHK002 - Are constructor parameters specified for every concrete processor that accepts configuration? [Completeness, Contracts §concrete-processors.md] — **Pass.** All constructors specified with full parameter lists and types.
- [x] CHK003 - Are default values documented for all optional constructor parameters (mask char, tab width, bracket chars, max distance, style classes)? [Completeness, Contracts §concrete-processors.md] — **Pass.** All defaults documented: PasswordProcessor char="*", HighlightMatchingBracketProcessor chars="[](){}<>" maxCursorDistance=1000, BeforeInput/AfterInput style="", AppendAutoSuggestion style="class:auto-suggestion", ShowLeadingWhiteSpaceProcessor style="class:leading-whitespace", ShowTrailingWhiteSpaceProcessor style="class:trailing-whitespace", TabsProcessor tabstop=4 char1="|" char2="\u2508" style="class:tab".
- [x] CHK004 - Are all 8 prerequisite changes (missing codebase items) fully specified with method signatures, types, and behavior? [Completeness, Spec §Assumptions (Incorrect)] — **Pass.** All 8 items specified in contracts/prerequisite-changes.md with full C# signatures. Cross-references added to spec.
- [x] CHK005 - Does the spec define `ExplodedList` behavior for all `Collection<T>` override hooks (`InsertItem`, `SetItem`, `AddRange`)? [Completeness, Contracts §utility-types.md] — **Pass.** All three hooks specified with auto-explosion behavior.
- [x] CHK006 - Are all `ToString()` overrides specified for processor types that have them (BeforeInput, AfterInput, ConditionalProcessor, ShowArg)? [Completeness, Contracts §concrete-processors.md] — **Fixed.** Added format strings to all four ToString() XML doc comments: BeforeInput → "BeforeInput({Text}, style={Style})", ShowArg → "ShowArg()", AfterInput → "AfterInput({Text}, style={Style})", ConditionalProcessor → "ConditionalProcessor(processor={Processor}, filter={Filter})".
- [x] CHK007 - Is the `ReverseSearchProcessor.ExcludedInputProcessors` static list of excluded processor types fully enumerated? [Gap, Data-Model §ReverseSearchProcessor] — **Fixed.** Enumerated in contracts/concrete-processors.md (HighlightSearchProcessor, HighlightSelectionProcessor, BeforeInput, AfterInput), data-model.md, and spec FR-037.
- [x] CHK008 - Are the `DefaultInputProcessors` list contents and ordering specified for `BufferControl`? [Gap, Contracts §prerequisite-changes.md] — **Fixed.** Added FR-036 to spec and updated contracts/prerequisite-changes.md with ordered list: HighlightSearchProcessor, HighlightIncrementalSearchProcessor, HighlightSelectionProcessor, DisplayMultipleCursors.

## Requirement Clarity

- [x] CHK009 - Is "position mapping" unambiguously defined with clear input/output semantics (source column index to display column index and vice versa)? [Clarity, Spec §FR-003] — **Fixed.** Added precise definition to Key Entities section: source-to-display maps zero-based column index in original line text to display column; display-to-source is the reverse; identity when no content length change.
- [x] CHK010 - Is the `MergedProcessor` position mapping composition algorithm described with enough detail to implement (list-based chaining, initial function removal)? [Clarity, Spec §FR-030, Research §RT-2] — **Fixed.** Strengthened FR-030 with list-based function chaining detail, mutable accumulation, and initial function removal semantics.
- [x] CHK011 - Is "fragment explosion" defined with a clear invariant (each element is exactly one character, preserving style and mouse handler)? [Clarity, Spec §FR-035] — **Pass.** FR-035 plus contracts/utility-types.md §ExplodeTextFragments describe the invariant clearly: "each element is exactly one character," "preserving style and mouse handler."
- [x] CHK012 - Is "cursor is on a bracket or immediately after a closing bracket" precisely defined for `HighlightMatchingBracketProcessor`? [Clarity, Spec §FR-023] — **Fixed.** FR-023 now specifies: "on a bracket" = `Document.CurrentChar` is in the bracket set; "immediately after" = `Document.CharBeforeCursor` is a closing bracket; temporary document with decremented cursor position for the latter case.
- [x] CHK013 - Is the `TabsProcessor` column alignment algorithm clearly specified (tab expands to next multiple of tab-stop width)? [Clarity, Spec §FR-019] — **Fixed.** FR-019 now includes: "Tab alignment MUST expand each tab to fill columns up to the next multiple of the tab-stop width (e.g., tab at column 0 with width 4 fills columns 0-3; tab at column 2 with width 4 fills columns 2-3)."
- [x] CHK014 - Is "the last line" unambiguously defined for `AfterInput` and `AppendAutoSuggestion` (last line of the document vs. last line in rendered fragments)? [Ambiguity, Spec §FR-015, FR-018] — **Fixed.** FR-015 now says "the line at index `Document.LineCount - 1`"; FR-018 now says "the last line (line at index `Document.LineCount - 1`)".
- [x] CHK015 - Is the `ShowArg` display format precisely specified including style classes and spacing (e.g., "(arg: N) " with trailing space)? [Clarity, Spec §FR-017] — **Fixed.** FR-017 now lists exact fragment tuples: `[("class:prompt.arg", "(arg: "), ("class:prompt.arg.text", "<N>"), ("class:prompt.arg", ") ")]`. Contract updated with matching output format section.
- [x] CHK016 - Is the `ReverseSearchProcessor` output format precisely specified with delimiters, style classes per segment, and handling of absent matches? [Clarity, Spec §FR-032, FR-033] — **Fixed.** FR-032 now lists exact styled fragments with "class:prompt.search" and "class:prompt.search.text" classes. Contract updated with full output format section and direction text values.

## Requirement Consistency

- [x] CHK017 - Are style class names consistent between spec FRs, contracts, and data model (e.g., "search" vs "class:search")? [Consistency, Spec §FR-006 vs Contracts §concrete-processors.md] — **Fixed.** Added "Style Class Naming Convention" entry to Key Entities in spec, explaining the two patterns: ClassName properties store bare names (prepended with `" class:"` when applied), Style properties store complete style strings.
- [x] CHK018 - Is the `HighlightMatchingBracketProcessor` style class naming consistent? (FR-024 says "matching-bracket.cursor"/"matching-bracket.other" but are these used consistently in contracts?) [Consistency, Spec §FR-024 vs Contracts] — **Pass.** FR-024 says "matching-bracket.cursor" and "matching-bracket.other" which match Python exactly (applied as `" class:matching-bracket.cursor "` and `" class:matching-bracket.other "`). Consistent across spec and contracts.
- [x] CHK019 - Are `BufferControl` constructor parameter additions in prerequisite-changes.md consistent with properties described in data-model.md and research.md? [Consistency, Contracts vs Data-Model vs Research] — **Fixed.** Added `SearchBufferControlFactory` (`Func<SearchBufferControl?>?`) to data-model.md to match the `searchBufferControlFactory` constructor parameter in prerequisite-changes.md.
- [x] CHK020 - Does the `Transformation` contract's `Fragments` type (`IReadOnlyList<StyleAndTextTuple>`) align with the `TransformationInput.Fragments` type? [Consistency, Contracts §transformation-types.md] — **Pass.** Both use `IReadOnlyList<StyleAndTextTuple>`.
- [x] CHK021 - Is the `SearchState` property return type consistent between BufferControl contract (returns `SearchState`) and the data model? [Consistency, Contracts §prerequisite-changes.md vs Data-Model §BufferControl] — **Pass.** Both specify `SearchState` return type with fallback to new empty `SearchState` when no search control is linked.

## Acceptance Criteria Quality

- [x] CHK022 - Can SC-001 ("100% API fidelity") be objectively measured against the Python source without subjective judgment? [Measurability, Spec §SC-001] — **Pass.** SC-001 enumerates all 20+ specific types. Fidelity is measurable by comparing each public API against the Python source and contracts.
- [x] CHK023 - Is SC-002 ("position mapping accuracy") defined with specific test scenarios beyond "chaining two processors that shift positions"? [Measurability, Spec §SC-002] — **Fixed.** SC-002 now enumerates specific processors that modify content length (BeforeInput, AfterInput, TabsProcessor, ReverseSearchProcessor, MergedProcessor) and requires bidirectional verification.
- [x] CHK024 - Is SC-003 ("80% coverage") scoped to processor implementations only, or does it include prerequisite changes and utility types? [Measurability, Spec §SC-003] — **Fixed.** SC-003 now explicitly scopes: all concrete processors, ExplodedList, ExplodeTextFragments, ProcessorUtils, MergedProcessor. Prerequisite changes covered by existing test suites.
- [x] CHK025 - Is SC-004 ("fragment explosion") measurable with defined input/output pairs for multi-char fragments with styles and mouse handlers? [Measurability, Spec §SC-004] — **Fixed.** SC-004 now enumerates the 5 processors requiring explosion: HighlightSearchProcessor, HighlightIncrementalSearchProcessor, HighlightSelectionProcessor, HighlightMatchingBracketProcessor, DisplayMultipleCursors.

## Scenario Coverage

- [x] CHK026 - Are acceptance scenarios defined for `HighlightSelectionProcessor` when selection spans multiple lines (cross-line highlighting)? [Coverage, Spec §User Story 3] — **Fixed.** Added scenario 6 to User Story 3: selection spanning lines 1-3 with per-line highlighting (start-to-end, full, start-to-col), including trailing space append.
- [x] CHK027 - Are acceptance scenarios defined for `PasswordProcessor` with multi-character Unicode text (e.g., CJK characters where one char may be multi-byte)? [Coverage, Spec §User Story 2] — **Fixed.** Added scenario 6 to User Story 2: multi-byte Unicode (CJK) characters replaced per-character (not per-byte), preserving styles.
- [x] CHK028 - Are acceptance scenarios defined for `AppendAutoSuggestion` when cursor is NOT at the end of the document? [Coverage, Spec §User Story 7] — **Fixed.** Added scenario 6 to User Story 7: suggestion exists but cursor not at end → empty string appended.
- [x] CHK029 - Are acceptance scenarios defined for `ShowArg` when arg is null (no repeat count active)? [Coverage, Spec §FR-017] — **Fixed.** Added scenario 7 to User Story 7: null arg → no text prepended. FR-017 also strengthened to say "return an empty fragment list when arg is null."
- [x] CHK030 - Are scenarios defined for `ConditionalProcessor` with `FilterOrBool` (both `IFilter` instance and raw `bool` value)? [Coverage, Spec §User Story 6] — **Pass.** User Story 6 tests filter returning true/false. `FilterOrBool` has implicit conversion from `bool`, so raw bool scenarios are covered by the existing filter-based scenarios (ConditionalProcessor constructor accepts `FilterOrBool`).
- [x] CHK031 - Are scenarios defined for `DisplayMultipleCursors` when Vi insert-multiple mode is NOT active (should pass through unchanged)? [Coverage, Spec §User Story 7] — **Fixed.** Added scenario 8 to User Story 7: Vi block insert mode NOT active → fragments pass through unchanged.

## Edge Case Coverage

- [x] CHK032 - Is behavior defined for `TabsProcessor` when tab stop width is 1 (degenerate case)? [Edge Case, Spec §Edge Cases] — **Fixed.** Added edge case: tab stop width 1 → each tab expands to exactly 1 character (first-char separator only).
- [x] CHK033 - Is behavior defined for `ShowLeadingWhiteSpaceProcessor` when the entire line is whitespace? [Edge Case, Gap] — **Fixed.** Added edge case: all-whitespace line → all spaces replaced with visible character since all are "leading."
- [x] CHK034 - Is behavior defined for `HighlightSearchProcessor` with regex special characters in search text (the spec says "regex-escaped" - is this requirement clear)? [Edge Case, Spec §FR-006] — **Fixed.** FR-006 now explicitly says "using `Regex.Escape` to treat the search text as a literal pattern."
- [x] CHK035 - Is behavior defined for `BeforeInput` and `AfterInput` when the document has zero lines? [Edge Case, Gap] — **Pass (non-issue).** Processors are called per-line by the rendering pipeline. A zero-line document produces no processor invocations, so BeforeInput/AfterInput are never called. No specification needed.
- [x] CHK036 - Is behavior defined for `ExplodedList` when `SetItem` is called with a multi-character fragment at an index (auto-explosion changes list length)? [Edge Case, Contracts §utility-types.md] — **Fixed.** Updated SetItem XML doc in contracts/utility-types.md: "the single item at index is removed and the exploded fragments are inserted starting at that index. This may change the list length."

## Dependencies & Assumptions

- [x] CHK037 - Is the `AppContext.GetApp()` cross-layer dependency (Layout layer 5 accessing Application layer 7) explicitly documented as a justified deviation with rationale? [Assumption, Plan §Complexity Tracking] — **Pass.** Documented in plan.md §Complexity Tracking with rationale: faithful port of Python's `get_app()` pattern.
- [x] CHK038 - Are all 8 "MISSING" prerequisite items from verified assumptions traced to specific contracts and FRs? [Traceability, Spec §Assumptions (Incorrect)] — **Fixed.** Added `→ Contract: [filename], FR-NNN` cross-references to each of the 8 MISSING items in the spec.
- [x] CHK039 - Is the dependency on `ConversionUtils.ToInt`/`ToStr` for `TabsProcessor`'s duck-typed constructor parameters documented? [Dependency, Contracts §concrete-processors.md] — **Pass.** Design note in contracts/concrete-processors.md explicitly documents the `ConversionUtils.ToInt` and `ConversionUtils.ToStr` dependency.
- [x] CHK040 - Is the trailing whitespace typo fix deviation documented with clear rationale and Python source reference? [Assumption, Spec §Clarifications] — **Pass.** Documented in spec §Clarifications, plan §Complexity Tracking, data-model §ShowTrailingWhiteSpaceProcessor, and contracts §concrete-processors.md with full rationale.

## Notes

- Focus: Full requirements quality across spec, contracts, data model, and research
- Depth: Standard (40 items)
- Audience: Reviewer (pre-implementation gate)
- Existing `requirements.md` checklist covers spec readiness; this checklist covers deeper requirements quality validation
- Items reference spec sections (§FR-NNN, §SC-NNN, §User Story N), contracts, data model, and research documents
- **Results**: 40/40 items resolved. 25 items required edits across 5 files (spec.md, concrete-processors.md, prerequisite-changes.md, utility-types.md, data-model.md). 15 items passed without changes.
